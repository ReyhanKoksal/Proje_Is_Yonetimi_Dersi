Imports System.Data.SqlClient

Public Class senet
    Private senet_o_no As Integer
    Private kurs_ucreti As Integer
    Private indirim As Integer
    Private top_s_tutari As Integer
    Private tarih As String
    Private ilk_vade_tarihi As String
    Private vade_sayisi As Integer
    Private tutari As Double

    Private no As Integer
    Private ad As String
    Private soyad As String
    
    Private sql As String
    Private baglanti As New SqlConnection("server=.\SQLEXPRESS; database=proje; trusted_connection=yes;")
    Private com As New SqlCommand()
    
    
    Sub baglan()
        com.Connection = baglanti
        com.CommandText = sql
        baglanti.Open()
        com.ExecuteReader()
        baglanti.Close()
    End Sub
    
    Sub listele()
        sql = "select * from senet_tbl"
        Dim adapt As New SqlDataAdapter(sql, baglanti)
        Dim ds As New DataSet()
        adapt.Fill(ds, "senet_liste")
        ogrenci_frm.senet_grd.DataSource = ds.Tables("senet_liste")
        ogrenci_frm.senet_grd.Refresh()
        
        //çağrı
        
                
    End Sub
    
    Sub guncelle()
        sql = "update senet_tbl set kurs_ucreti='" & kurs_ucreti & "', indirim='" & indirim & "', top_s_tutari='" & top_s_tutari & "', tarihi='" & tarih & "', ilk_vade_tarihi='" & ilk_vade_tarihi & "', vade_sayisi='" & vade_sayisi & "', tutari='" & tutari & "' where numarasi ogr_no = '" & senet_o_no & "'"
        baglan()
        listele()
    End Sub
    
    Sub ara()
        sql = "select * from senet_tbl where ogr_no = '" & senet_o_no & "'"
        Dim adapt As New SqlDataAdapter(sql, baglanti)
        Dim ds As New DataSet()
        adapt.Fill(ds, "SenetBilgileri")
        ogrenci_frm.senet_grd.DataSource = ds.Tables("SenetBilgileri")
        ogrenci_frm.senet_grd.Refresh()

    End Sub
    
     Sub sil()
        sql = "delete from senet_tbl where ogr_no = '" & senet_o_no & "'"
        baglan()
        listele()
    End Sub
    
    Sub ekle()
        For i = 1 To vade_sayisi
            Dim durum As String = "ödenmedi"
            tarih = CStr(CDate(tarih).Date.AddMonths(1))
            sql = "INSERT INTO senet_tbl(ogr_no,kurs_ucreti,indirim,top_s_tutari,tarihi,ilk_vade_tarihi,vade_sayisi,tutari,senet_no,durum) values ('" & senet_o_no & "','" & kurs_ucreti & "','" & indirim & "','" & top_s_tutari & "','" & tarih & "','" & ilk_vade_tarihi & "','" & vade_sayisi & "','" & tutari & "','" & i & "','" & durum & "')"
            baglan()
            listele()
        Next i

    End Sub
    
    Sub textaktar()
       
            sql = "SELECT * from ogrenci_sicil_tbl WHERE numarasi = " & senet_o_no & ""
            Dim satir1 As DataRow
            Dim adapt As New SqlDataAdapter(sql, baglanti)
            Dim ds As New DataSet("ds")
            adapt.Fill(ds, "ogrenci")
            satir1 = ds.Tables("ogrenci").Rows(0)
            ad = satir1("adi").ToString
            
            baglan()
        
   //çağrı
   
    End Sub
    
    
     Sub kontrol()
        ogrenci_frm.s_bilgi_ata()
        no = CInt(ogrenci_frm.senet_ogr_no_txt.Text)
        sql = "select * from senet_tbl where ogr_no = '" & no & "'"
        baglan()
        Dim satir1 As DataRow
        Dim adapt As New SqlDataAdapter(sql, baglanti)
        Dim ds As New DataSet("ds")
        adapt.Fill(ds, "Kontrol")
        Try
            satir1 = ds.Tables("Kontrol").Rows(0)
            MsgBox("Bu öğrenciye düzenlenmiş bir senet zaten var!")
            ogrenci_frm.senet_ogr_no_txt.Focus()
        Catch
            ekle()
        End Try
        
    End Sub
    
    End Class

